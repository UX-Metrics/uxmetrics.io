<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UXMetrics Test Site</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            line-height: 1.6;
            color: #333;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        .content {
            margin-bottom: 40px;
        }
        .section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .button {
            background: #7c3aed;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .button:hover {
            background: #6d28d9;
        }
        .button.secondary {
            background: #64748b;
        }
        .button.secondary:hover {
            background: #475569;
        }
        .button.danger {
            background: #dc2626;
        }
        .button.danger:hover {
            background: #b91c1c;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d1fae5; border-left: 4px solid #10b981; }
        .info { background: #dbeafe; border-left: 4px solid #3b82f6; }
        .warning { background: #fef3cd; border-left: 4px solid #f59e0b; }
        
        .console-log {
            background: #1f2937;
            color: #e5e7eb;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .control-section {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
        }

        .button-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .storage-info {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            border: 1px solid #d1d5db;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ UXMetrics Test Site</h1>
        <p>Testing the UXMetrics widget integration on dev.uxmetrics.com</p>
        <div id="script-status" class="status info">
            <strong>Status:</strong> <span id="status-text">Initializing...</span>
        </div>
    </div>

    <div class="content">
        <div class="section">
            <h2>About This Page</h2>
            <p>This test page simulates a real website with the UXMetrics snippet installed. It's designed to help verify that the widget loads and functions correctly.</p>
            <p><strong>Current URL:</strong> <code id="current-url"></code></p>
            <p><strong>Referrer:</strong> <code id="referrer"></code></p>
        </div>

        <div class="section control-section">
            <h2>üõ†Ô∏è Widget Controls</h2>
            <p>Use these controls to manage the widget state and testing modes:</p>
            
            <div class="button-row">
                <button class="button danger" onclick="clearLocalStorage()">üóëÔ∏è Clear localStorage</button>
                <button class="button secondary" onclick="loadFullScreenMode()">üñ•Ô∏è Load Full Screen Mode</button>
                <button class="button" onclick="reloadWidget()">üîÑ Reload Widget</button>
            </div>

            <div class="storage-info" id="storage-info">
                Loading storage information...
            </div>
        </div>

        <div class="section">
            <h2>Interaction Test</h2>
            <p>Use these buttons to generate user interactions that might trigger surveys:</p>
            <div class="button-row">
                <button class="button" onclick="logInteraction('button_click', 'Test Button 1')">Test Button 1</button>
                <button class="button" onclick="logInteraction('button_click', 'Test Button 2')">Test Button 2</button>
                <button class="button" onclick="simulatePageView()">Simulate Page View</button>
                <button class="button secondary" onclick="clearLogs()">Clear Console</button>
            </div>
        </div>

        <div class="section">
            <h2>Sample Content</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>
            <p>This content helps simulate a real website where users would naturally interact and provide feedback through the UXMetrics widget.</p>
        </div>

        <div class="section">
            <h2>Console Output</h2>
            <div id="console-output" class="console-log">
                <div>üîç Monitoring UXMetrics script loading...</div>
            </div>
        </div>
    </div>

    <!-- Test Site JavaScript -->
    <script>
        // Global flag to track widget mode
        let isFullScreenMode = false;

        // Initialize page info
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('referrer').textContent = document.referrer || 'No referrer';
            
            // Monitor for any UXMetrics related activity
            logToConsole('üìÑ Page loaded: ' + window.location.href);
            updateStorageInfo();
        });

        function logToConsole(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            
            let prefix = '';
            switch(type) {
                case 'success': prefix = '‚úÖ'; break;
                case 'error': prefix = '‚ùå'; break;
                case 'warning': prefix = '‚ö†Ô∏è'; break;
                default: prefix = '‚ÑπÔ∏è'; break;
            }
            
            div.innerHTML = `<span style="color: #6b7280;">[${timestamp}]</span> ${prefix} ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        function updateStatus(text, type = 'info') {
            const statusEl = document.getElementById('script-status');
            const textEl = document.getElementById('status-text');
            
            textEl.textContent = text;
            statusEl.className = 'status ' + type;
        }

        function updateStorageInfo() {
            const storageInfo = document.getElementById('storage-info');
            
            // Get all localStorage items with 'uxmetrics' in the key
            const uxmetricsItems = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.toLowerCase().includes('uxmetrics')) {
                    const value = localStorage.getItem(key);
                    uxmetricsItems.push(`${key}: ${value}`);
                }
            }

            // Get all sessionStorage items with 'uxmetrics' in the key
            const sessionItems = [];
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                if (key && key.toLowerCase().includes('uxmetrics')) {
                    const value = sessionStorage.getItem(key);
                    sessionItems.push(`${key}: ${value}`);
                }
            }

            let info = '<strong>üì¶ Storage Information:</strong><br>';
            info += '<strong>localStorage UXMetrics items:</strong><br>';
            if (uxmetricsItems.length > 0) {
                info += uxmetricsItems.join('<br>') + '<br>';
            } else {
                info += 'No UXMetrics items found<br>';
            }
            
            info += '<br><strong>sessionStorage UXMetrics items:</strong><br>';
            if (sessionItems.length > 0) {
                info += sessionItems.join('<br>');
            } else {
                info += 'No UXMetrics items found';
            }

            storageInfo.innerHTML = info;
        }

        function clearLocalStorage() {
            if (confirm('This will clear ALL localStorage data for this domain. Continue?')) {
                // Get all keys before clearing
                const allKeys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    allKeys.push(localStorage.key(i));
                }
                
                // Clear localStorage
                localStorage.clear();
                
                // Also clear sessionStorage UXMetrics items
                const sessionKeys = [];
                for (let i = 0; i < sessionStorage.length; i++) {
                    const key = sessionStorage.key(i);
                    if (key && key.toLowerCase().includes('uxmetrics')) {
                        sessionKeys.push(key);
                    }
                }
                sessionKeys.forEach(key => sessionStorage.removeItem(key));
                
                logToConsole(`üóëÔ∏è Cleared localStorage (${allKeys.length} items) and UXMetrics sessionStorage items`, 'success');
                updateStorageInfo();
                
                // Remove any existing widgets from DOM
                const existingWidgets = document.querySelectorAll('div[style*="position: fixed"]');
                existingWidgets.forEach(widget => {
                    if (widget.style.bottom || widget.style.right || widget.innerHTML.includes('Submit')) {
                        widget.remove();
                        logToConsole('üóëÔ∏è Removed existing widget from DOM', 'success');
                    }
                });
                
                updateStatus('localStorage cleared - ready for fresh widget load', 'success');
            }
        }

        function loadFullScreenMode() {
            logToConsole('üñ•Ô∏è Loading widget in full screen mode...', 'info');
            isFullScreenMode = true;
            
            // Remove any existing widgets
            const existingWidgets = document.querySelectorAll('div[style*="position: fixed"]');
            existingWidgets.forEach(widget => {
                if (widget.style.bottom || widget.style.right || widget.innerHTML.includes('Submit')) {
                    widget.remove();
                }
            });
            
            // Set the global FULL_SCREEN_MODE variable that the widget script will read
            window.UXMETRICS_FULL_SCREEN_MODE = true;
            
            // Reload the widget script with full screen mode
            loadWidgetScript(true);
        }

        function reloadWidget() {
            logToConsole('üîÑ Reloading widget...', 'info');
            
            // Remove existing widgets
            const existingWidgets = document.querySelectorAll('div[style*="position: fixed"]');
            existingWidgets.forEach(widget => {
                if (widget.style.bottom || widget.style.right || widget.innerHTML.includes('Submit')) {
                    widget.remove();
                    logToConsole('üóëÔ∏è Removed existing widget from DOM', 'success');
                }
            });
            
            // Remove existing script tag
            const existingScript = document.querySelector('script[src*="dev.uxmetrics.com/s"]');
            if (existingScript) {
                existingScript.remove();
            }
            
            // Reset full screen mode flag unless explicitly set
            window.UXMETRICS_FULL_SCREEN_MODE = isFullScreenMode;
            
            // Reload the widget
            setTimeout(() => {
                loadWidgetScript(isFullScreenMode);
            }, 500);
        }

        function loadWidgetScript(fullScreen = false) {
            // Create a fresh script element
            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://dev.uxmetrics.com/s';
            
            script.onload = function() {
                const mode = fullScreen ? 'full screen' : 'widget';
                logToConsole(`‚úÖ UXMetrics: Widget loaded successfully in ${mode} mode`, 'success');
                updateStatus(`Widget loaded successfully (${mode} mode)`, 'success');
                updateStorageInfo();
            };
            
            script.onerror = function() {
                logToConsole('‚ùå UXMetrics: Failed to load. Check domain verification at http://dev.uxmetrics.com/measure', 'error');
                updateStatus('Failed to load widget', 'error');
            };
            
            document.head.appendChild(script);
            logToConsole(`üöÄ UXMetrics: Script injection started (${fullScreen ? 'full screen' : 'widget'} mode)...`);
        }

        function logInteraction(type, label) {
            logToConsole(`üñ±Ô∏è User interaction: ${type} - ${label}`);
            
            // Dispatch custom event that UXMetrics might listen for
            window.dispatchEvent(new CustomEvent('uxmetrics:interaction', {
                detail: { type, label, timestamp: Date.now() }
            }));
        }

        function simulatePageView() {
            logToConsole('üìÑ Simulated page view event');
            
            // Simulate a page navigation that might trigger surveys
            window.dispatchEvent(new CustomEvent('uxmetrics:pageview', {
                detail: { 
                    url: window.location.href,
                    title: document.title,
                    timestamp: Date.now()
                }
            }));
        }

        function clearLogs() {
            document.getElementById('console-output').innerHTML = '<div>üîç Console cleared - Monitoring UXMetrics script loading...</div>';
        }

        // Override console.log to capture UXMetrics logs
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            
            // Check if this is a UXMetrics related log
            const message = args.join(' ');
            if (message.toLowerCase().includes('uxmetrics') || message.toLowerCase().includes('widget')) {
                logToConsole(`üìã Console: ${message}`);
            }
        };

        // Override console.warn and console.error too
        const originalWarn = console.warn;
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            const message = args.join(' ');
            if (message.toLowerCase().includes('uxmetrics') || message.toLowerCase().includes('widget')) {
                logToConsole(`‚ö†Ô∏è Warning: ${message}`, 'warning');
            }
        };

        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            const message = args.join(' ');
            if (message.toLowerCase().includes('uxmetrics') || message.toLowerCase().includes('widget')) {
                logToConsole(`‚ùå Error: ${message}`, 'error');
            }
        };

        // Monitor for any widgets being added to the page
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1) { // Element node
                        // Check if this looks like a UXMetrics widget
                        if (node.classList && (
                            node.classList.contains('uxmetrics') ||
                            node.classList.contains('pulse') ||
                            node.classList.contains('widget') ||
                            node.id && node.id.includes('uxmetrics')
                        )) {
                            logToConsole(`üéØ Widget detected: ${node.tagName} with class "${node.className}"`, 'success');
                        }
                        
                        // Also check for fixed position elements that might be widgets
                        if (node.style && node.style.position === 'fixed' && 
                            (node.style.bottom || node.style.right) &&
                            node.innerHTML && node.innerHTML.includes('Submit')) {
                            const mode = node.style.width === '100%' ? 'full screen' : 'widget';
                            logToConsole(`üéØ UXMetrics widget injected (${mode} mode)`, 'success');
                            updateStorageInfo();
                        }
                    }
                });
            });
        });

        observer.observe(document.body, {
            childList: true,
            subtree: true
        });

        // Update storage info periodically
        setInterval(updateStorageInfo, 5000);
    </script>

    <!-- UXMetrics Widget -->
    <script>
    (function() {
        'use strict';
        
        // Check if full screen mode was requested
        const fullScreenMode = window.UXMETRICS_FULL_SCREEN_MODE || false;
        
        // Load UXMetrics widget - Industry standard approach
        const script = document.createElement('script');
        script.async = true;
        script.src = 'https://dev.uxmetrics.com/w/54fb5f3f-2db0-4cae-b984-05216c5502a8.js';
        script.onload = function() {
            const mode = fullScreenMode ? 'full screen' : 'widget';
            logToConsole(`‚úÖ UXMetrics: Widget loaded successfully in ${mode} mode`, 'success');
            updateStatus(`Widget loaded successfully (${mode} mode)`, 'success');
        };
        script.onerror = function() {
            logToConsole('‚ùå UXMetrics: Failed to load. Check domain verification at http://dev.uxmetrics.com/measure', 'error');
            updateStatus('Failed to load widget', 'error');
        };
        
        document.head.appendChild(script);
        logToConsole('üöÄ UXMetrics: Script injection started...');
    })();
    </script>

</body>
</html>
